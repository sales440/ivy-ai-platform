# Railway OAuth Configuration Guide

## Problem

When deploying to Railway, users cannot login because the OAuth redirect URI is not authorized:

```
[internal] authorization failed: invalid redirect_uri: redirect_uri domain 
'ivy-ai-platform-production.up.railway.app' not allowed for this project
```

## Solution

You need to add the Railway domain to the **Allowed Redirect URIs** in your Manus OAuth configuration.

---

## Step-by-Step Instructions

### 1. Get Your Railway Domain

Your Railway deployment URL is:
```
https://ivy-ai-platform-production.up.railway.app
```

### 2. Configure OAuth in Manus Dashboard

1. Go to **Manus Dashboard** → **Settings** → **OAuth Settings**
2. Find the section **"Allowed Redirect URIs"** or **"Authorized Redirect URLs"**
3. Add the following URL:
   ```
   https://ivy-ai-platform-production.up.railway.app/api/oauth/callback
   ```

### 3. Verify Configuration

After adding the redirect URI, your OAuth configuration should include:

**Development:**
- `http://localhost:3000/api/oauth/callback`
- `https://3000-*.manusvm.computer/api/oauth/callback`

**Production:**
- `https://ivy-ai-platform-production.up.railway.app/api/oauth/callback`

### 4. Test Login

1. Open your Railway app: https://ivy-ai-platform-production.up.railway.app
2. Click "Login" or navigate to a protected route
3. You should be redirected to Manus OAuth portal
4. After authentication, you should be redirected back to your app successfully

---

## Custom Domain (Optional)

If you want to use a custom domain instead of the Railway subdomain:

### 1. Add Custom Domain in Railway

1. Go to Railway Dashboard → Your Project → Settings → Domains
2. Click "Add Domain"
3. Enter your custom domain (e.g., `ivy-ai.yourdomain.com`)
4. Follow Railway's instructions to configure DNS

### 2. Update OAuth Configuration

Add your custom domain to Manus OAuth settings:
```
https://ivy-ai.yourdomain.com/api/oauth/callback
```

### 3. Update Environment Variables (if needed)

If your app uses `VITE_OAUTH_PORTAL_URL` or similar variables, make sure they point to the correct domain.

---

## Troubleshooting

### Error: "redirect_uri domain not allowed"

**Cause:** The Railway domain is not in the OAuth allowed list.

**Solution:** Add the exact Railway URL to Manus OAuth settings as shown in Step 2.

### Error: "Invalid redirect_uri parameter"

**Cause:** Typo in the redirect URI or missing `/api/oauth/callback` path.

**Solution:** Make sure the redirect URI ends with `/api/oauth/callback`

### Login works locally but not on Railway

**Cause:** You added localhost to OAuth settings but forgot to add the Railway domain.

**Solution:** Add **both** localhost (for development) and Railway domain (for production) to OAuth settings.

---

## Environment Variables Checklist

Make sure these environment variables are set in Railway:

```bash
# OAuth Configuration (automatically injected by Manus)
VITE_APP_ID=<your-app-id>
OAUTH_SERVER_URL=https://api.manus.im
VITE_OAUTH_PORTAL_URL=https://app.manus.im/oauth

# Database
DATABASE_URL=<railway-mysql-connection-string>

# JWT Secret
JWT_SECRET=<auto-generated-secret>

# Other required variables
OWNER_OPEN_ID=<your-open-id>
OWNER_NAME=<your-name>
```

---

## Need Help?

If you're still having issues:

1. **Check Railway logs** for detailed error messages
2. **Verify OAuth settings** in Manus Dashboard
3. **Ensure all environment variables** are set correctly in Railway
4. **Contact Manus support** if the issue persists

---

## Quick Reference

**Railway App URL:**
```
https://ivy-ai-platform-production.up.railway.app
```

**OAuth Callback URL to add:**
```
https://ivy-ai-platform-production.up.railway.app/api/oauth/callback
```

**Where to configure:**
Manus Dashboard → Settings → OAuth Settings → Allowed Redirect URIs
